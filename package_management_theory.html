<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>How to make reproducible software environments: Package management theory</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #000">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/package_management_theory.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      How to make reproducible software environments
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            How to make reproducible software environments
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  How to make reproducible software environments
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 17%" class="percentage">
    17%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 17%" aria-valuenow="17" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/package_management_theory.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="reproducibility_definition.html">1. Reproducibility definition</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        2. Package management theory
        </span>
      
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="environment_specifications.html">3. Environment specifications</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="containerization_and_virtualization.html">4. Containerization and virutalization</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="reproducible_software_environments.html">5. Engineering Reproducible Software</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="engineering_reproducible_software.html">6. Package managers in practice</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="reproducibility_definition.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="environment_specifications.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="reproducibility_definition.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Reproducibility
        </a>
        <a class="chapter-link float-end" href="environment_specifications.html" rel="next">
          Next: Environment... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Package management theory</h1>
        <p>Last updated on 2024-06-18 |
        
        <a href="https://github.com/charmoniumQ/reproducibility-carpentry/edit/main/episodes/package_management_theory.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>TODO</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>To explain the terms: from-source package manager, binary package
manager, single-version package repository, multiple-version package
repository, and the diamond dependency problem</li>
<li>To synthesize the pros/cons of from-binary vs from-source and
single-coherent-set vs SAT-solving</li>
</ul></div>
</div>
</div>
</div>
</div>
<p>A <strong>package manager</strong> is a program that manages
(installs, upgrades, removes) a given target software and the target’s
software dependencies.</p>
<p>There are several distinguishing features of package managers: 1.
whether they install packages by compiling the packages from source or
downloading binary files 2. whether they attempt to solve dependency 3.
whether they operate on a local or system-wide environment</p>
<div class="section level1">
<h1 id="from-source-or-binary">From-source or binary<a class="anchor" aria-label="anchor" href="#from-source-or-binary"></a></h1>
<p><strong>Binary package managers</strong> install software by
downloading pre-compiled files and placing them in certain paths.</p>
<p><strong>From-source package managers</strong> install software
primarily by downloading source code, compiling it, and placing it in
certain paths. However, from-source package managers may optionally use
a binary cache, where they can download a pre-compiled binary; the
salient difference between from-source with binary cache package
managers and binary-only package managers is that the former can always
“fall back” on compiling the source when the binaries when the cache
can’t be used for an arbitrary reason.</p>
<p>This design choice influences the following qualities:</p>
<ul><li><p><strong>Speed</strong>: downloading pre-compiled binaries is
often faster (assuming the network is fast enough relative to the
slowness of compilation). However binary caches speed up from-source
package managers in common cases<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p></li>
<li><p><strong>Security</strong>: users of binary package managers
implicitly trust the package repository storage/delivery and the
compiler stack of the maintainer who compiled the package in the first
place. However, organizations may audit builds can move trust from the
maintainer to the auditor (which may be the end-user). From-source
package managers implicitly trust the package repository
storage/delivery and compiler stack on the user’s system.</p></li>
<li><p><strong>Flexibility</strong>: compilation may to include certain
assumptions about the runtime system (e.g., dynamic library RUNPATH) or
certain extensions (e.g., <code>--disable-ipv6</code>). Users of binary
package managers are subject to whatever compile-time options the
maintainer used. They can alleviate this by offering multiple variants
of the binary at greater storage cost. From-source package managers make
it much easier to automatically or manually change compile-time
options.</p></li>
<li><p><strong>Infrastructure cost</strong>: binary packages are
expensive to store. A binary is specific to a CPU instruction-set
architecture (ISA) (e.g., x86 64-bit and ARMv8-A), operating system
kernel<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>
(e.g., Linux, MacOS, and Windows), and version of the software. Each
package manager has a different binary format, be it DEB for APT, RPM
for YUM/DNF, Wheels for Pip, etc., so reuse between package managers is
rare. Meanwhile, the version-controlled source-code is shared by users
of all CPU ISAs, all OS kernels, all versions<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>, and all from-source
package managers<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p></li>
</ul><p>In my opinion, the most important factor is infrastructure cost.
<strong>Storing binaries for every ISA, OS, and software version is
expensive, so nobody does it for free forever.</strong> For example, APT
depends on volunteers or organizations to host repositories for free but
not forever; <a href="http://ftp.debian.org/debian/dists/" class="external-link">ftp.debian.org</a> has
nothing older than Debian 10.x (2019 – expected 2024) at the time of
writing. Software environments based on Debian 9.x (new in 2017) may not
be reproducible today. The same problems exist for Ubuntu, Fedora,
CentOS, and even multi-platform binary package managers like Conda.<a href="#fn5" class="footnote-ref" id="fnref5"><sup>5</sup></a></p>
<p>See caveats about Docker<a href="#fn6" class="footnote-ref" id="fnref6"><sup>6</sup></a>; I will use it here to demonstrate
“starting from a clean install and running one command.”</p>
<pre class="docker"><code>FROM debian:9
RUN apt-get update
# At the time of writing, this Dockerfile will fail at this step.</code></pre>
<p>On the other hand, storing the source code is much less expensive,
and Software Heritage committed to storing the source code of important
open-source infrastructure for free for a long time.<a href="#fn7" class="footnote-ref" id="fnref7"><sup>7</sup></a></p>
<p>Many software projects not only release the source code, they often
allow users to modify the source code. This makes their software more
debuggable, repairable, and extensible; if it breaks, users can fix it
themselves. However, the benefits of open-source are not realized if
there is more friction in installing from source than installing from
binary. Users would have to locate the source code, download it, learn
its build system, find the package manager’s build recipe for it, learn
the package manager’s packaging system, build the binary package, serve
the binary from a package repository, add the repository to their
package managers sources list, and install it. When installing from
binaries is the common-case, installing from source may become neglected
and flaky.</p>
<p>However, the process of compiling software has its own operating
conditions necessary for equivalent-behavior reproducibility<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a> (e.g.,
“requires GCC 12”). But who compiles the compiler? The operating
conditions of the package manager itself can be thought of as a “trusted
computing base”.</p>
<p>A <strong>trusted computing base (TCB)</strong> is a term from
computer security for a small set of software that security analysts
assume correctly implements a certain contract, which is usually kept
dead-simple. They develop guarantees of the form “assuming the TCB is
correct to its TCB contract, this high-level software correctly
implements this high-level contract”. Package managers think of TCB as a
small set of software that is “trusted to be reproducible” rather than
“trusted to be secure”. As in computer security, package managers should
strive to keep their TCB as easy to reproduce as possible, either by
making it small or making a good installer that enforces the operating
conditions. <a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a></p>
<p>One may try to pre-compile binary packages for all relevant
platforms, but one simply can’t predict what ISAs their users will have
in the future. The set of popular ISAs is in constant flux: - <a href="https://en.wikipedia.org/wiki/Itanium" class="external-link">Itanium</a> (2001 – 2021)
processors are no longer purchasable - <a href="https://www.wikiwand.com/en/SPARC" class="external-link">SPARC</a> (1987 – 2029
expected) is planned to go that way too - <a href="https://en.wikipedia.org/wiki/Power_ISA" class="external-link">PowerPC</a> (2006) is
exceedingly rare for desktop consumers at the time of writing - <a href="https://en.wikipedia.org/wiki/X86-64" class="external-link">x86 64-bit</a> (2000) and <a href="https://en.wikipedia.org/wiki/ARM_architecture_family#64/32-bit_architecture" class="external-link">ARMv8-A</a>
(2011) have soared (for ARM, due to the popularity of the Raspberry Pi
and Apple M-series), with backwards compatibility for <a href="https://en.wikipedia.org/wiki/ARM_architecture_family#32-bit_architecture" class="external-link">ARMv7-A</a>
(2007) and <a href="https://en.wikipedia.org/wiki/X86" class="external-link">x86 32-bit</a>
(1985) - But even the hegemony of x86-64 is not certain, given Intel’s
proposed <a href="https://en.wikipedia.org/wiki/X86-64" class="external-link">x86S</a>
(2023).</p>
<p>For these reasons, I suggest using a from-source package manager for
long-term reproducibility.</p>
<p>TODO: table</p>
</div>
<div class="section level1">
<h1 id="dependency-constraint-solving-or-not">Dependency Constraint solving or not<a class="anchor" aria-label="anchor" href="#dependency-constraint-solving-or-not"></a></h1>
<p>Every package has a <strong>version</strong>, which are ordered in
sequence<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>.</p>
<p>A <strong>dependency constraint</strong> occurs when operating some
versions of A requires operating B (operate usually means compile or
run). Since the packages have multiple versions, each version of A may
depend on having one of a set of versions of B. Some versions of A may
not depend on B at all, but so long as other versions of A do, we will
say A has a dependency constraint on B. Usually, dependency constraints
map a range of versions of A to a range of versions of B, where a range
is an upper- and lower-bound, but there can be . E.g., (Numba 0.58
requires Python at least 3.8 and at most 3.11; Numba 0.55 requires
Python at least 3.7 and at most 3.10; …). If the dependency constraint
is violated, operating the package invokes undefined behavior.</p>
<p>A <strong>Diamond dependency</strong> is a set of packages and
dependency constraints where A depends on B and C, B and C depend on D,
and the user wants to install A<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>.</p>
<!-- TODO: figure -->
<p>A <strong>consistent set</strong> is a mapping from packages to
versions, satisfying dependency constraints.</p>
<p><strong>Dependency constraint solving</strong> is the process of
finding a consistent set. If the user asks for Python and Numba, package
version resolution may select Numba==0.58 and Python==3.11.</p>
<p>Dependency constraint solving for a diamond dependency is
particularly tricky. If one selects a candidate for A (perhaps
defaulting to the latest), and then selects compatible candidates for B
and C. However, those candidate versions of B and C may require
different versions of D. One may try different candidates for B and C
that are compatible with our selected candidate for A, but perhaps none
of these will work. In that case, one has to “backtrack” even further
and select a new candidate for A. A itself may have been the downstream
package of another diamond dependency, so one may have to backtrack on
those candidates, and so on.</p>
<p>In general, dependency constraint solving is NP-complete<a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a> due to
the necessity of backtracking in diamond dependencies. Oversimplify the
details, NP-completeness means the runtime of the fastest known<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>
algorithm scales exponentially<a href="#fn14" class="footnote-ref" id="fnref14"><sup>14</sup></a> with the input.</p>
<p>Dependency constraint solving is often implemented as a call to an
external <a href="https://www.wikiwand.com/en/SAT_solver" class="external-link">boolean
satisfiability (SAT) solver</a>). Since they are used in many problems,
SAT solvers have been optimized for decades; their runtime is still
exponential but a lesser exponential than home-built solutions.</p>
<!-- Slow dependency solving is particularly a pain point for Conda users^[See [conda/conda#7239 on GitHub](https://github.com/conda/conda/issues/7239)]. -->
<!-- [Mamba](https://mamba.readthedocs.io/en/latest/index.html) is a drop-in replcaement for Conda that uses a faster dependency constraint solver, called [libsolv](https://github.com/openSUSE/libsolv). -->
<!-- Conda introduced an experimental option to use Mamba's wrapper around libsolv^[See [A Faster Solver for Conda: Libmamba on Anaconda's blog 2016](https://www.anaconda.com/blog/a-faster-conda-for-a-growing-community)]. -->
<p>Some package managers attempt to reduce the complexity of solving by
the following strategies:</p>
<ul><li><p>Reducing the number of candidate versions by using fewer package
repositories (<a href="https://docs.conda.io/projects/conda/en/latest/user-guide/concepts/conda-performance.html#set-strict-channel-priority" class="external-link">Conda’s
strict package priority</a> and <a href="https://medium.com/@marius.v.niekerk/conda-metachannel-f962241c9437" class="external-link">Conda
meta-channel</a>).</p></li>
<li><p>Ordering the candidates such that the correct solve is found
earlier (<a href="https://stackoverflow.com/a/66963979/1078199" class="external-link">reordering Conda
channels</a>).</p></li>
<li>
<p>NodeJS has a notion of “public dependencies” (called “<a href="https://nodejs.org/en/blog/npm/peer-dependencies" class="external-link">peer
dependencies</a>” to NodeJS developers) and “private dependencies”
(called “dependencies” to NodeJS developers). Private dependencies don’t
need to be consistent with each other, so the more dependencies that can
be treated as private dependencies rather than public dependencies the
simpler the dependency graph becomes. When B and C privately depend on
D, <code>require("D")</code> from B can loads a different version than
<code>require("D")</code> from C (see <a href="https://lexi-lambda.github.io/blog/2016/08/24/understanding-the-npm-dependency-model/" class="external-link">Understanding
the npm dependency model by King on their blog 2016</a>). However, if
types or global variables from one package end up in the public
interface of another, it has to be a public dependency.</p>
<p>Nix can also make dependencies “private” in some cases. If B and C
require D to be on the <code>$PATH</code>, Nix can replace B with a <a href="https://nixos.org/manual/nixpkgs/stable/#fun-makeWrapper" class="external-link">wrapper
script</a> that adds a specific version of D to the <code>$PATH</code>
and executes the underlying B program, and likewise for C. No copy of D
needs to be on the global <code>$PATH</code>; the right version of D is
always put on the <code>$PATH</code> “just in time” for execution of B
or C, and the version of D for B does not interfere with the version of
D for C.</p>
</li>
<li><p>Package repositories contain few or only one version of each
package (APT/apt-get). This reduces the number of candidates to search
through. However, the community has to ensure that a the repository
contains a consistent set for every set of packages.</p></li>
</ul><p>Therefore, some package managers avoid the package version resolution
altogether using one of the following strategies.</p>
<ul><li><p>Let the user solve dependency constraints themselves (e.g., Pip
before version 20.3). This is only practical when the version
constraints are loose; i.e., the newest version of A will work with any
new-ish version of B.</p></li>
<li><p>Only allow a single version of every package from a
manually-maintained consistent set (e.g., <a href="https://www.stackage.org/" class="external-link">Haskell Stackage</a>).</p></li>
<li><p><a href="https://maven.apache.org/guides/introduction/introduction-to-dependency-mechanism.html" class="external-link">When
Maven encounters a diamond dependency</a>, either B or C, whichever is
closer to the root, gets its preferred version of D and the other
constraint gets ignored. The user often specifies the exact version of D
themselves to ensure correctness.</p></li>
</ul><p>|——————————————————-|——————————————————————-| | Pkg mgrs with dep
solv | Pip <a href="https://pip.pypa.io/en/stable/topics/dependency-resolution/#backtracking" class="external-link">&gt;=
20.3</a>, Conda, Mamba, Spack, 0install | | Pkg mgrs with dep solv,
limited repos<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> | DNF, YUM, APT | | Pkg mgrs with no dep
solv | Nix, Guix, Pacman, Maven, Pip &lt; 20.3 |</p>
</div>
<div class="section level1">
<h1 id="local-or-system-wide">Local or system-wide<a class="anchor" aria-label="anchor" href="#local-or-system-wide"></a></h1>
<p>Package managers either install to a local or a system-wide software
environment.</p>
<p>System-wide software environment package managers are necessary for
several reasons:</p>
<ul><li><p><strong>Hardcoded paths</strong>: Some software uses hardcoded,
unchangeable paths to root-owned directories, for example
<code>/usr/lib</code>. Most software today does not have hardcoded
paths, and so long as their source code is available and licensed for
modifications, it isn’t unchangeable. Nevertheless, this issue was more
important when package managers were designed.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p></li>
<li><p><strong>System-wide effect</strong>: Some software has
system-level effects or uses, e.g., the bootloader, the kernel, drivers,
and login manager are installed using a system-wide package
manager.</p></li>
<li><p><strong>Save space</strong>: Historically, disk space was
expensive, so system administrators (sysadmins) did not want users
compiling the same package just for themselves. Rather, the sysadmins
installed one for everyone to a global location upon request.</p></li>
</ul><p>On the other hand, local environment package managers have the
following benefits:</p>
<ul><li><p><strong>Reduce dependency conflicts</strong>: Suppose project A
have conflicting dependencies with project B (unsatisfiable), but if
they both have their own local environment, this is no bother. Local
environments naturally have fewer packages than their system-wide union,
minimizing the time needed to SAT-solve.</p></li>
<li><p><strong>Principle of least privilege</strong>: Normal users can
manage software environments without superuser privilege.</p></li>
</ul><p>Containers and virtual machines are one way of using system-wide
package managers in a local-environment.</p>
</div>
<div class="section level1">
<h1 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h1>
<p>TODO: APT isn’t really snapshottable We suggest using from-source
package managers. If your application requires specific versions, local
is better</p>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</div>
<div class="footnotes footnotes-end-of-document">
<hr><ol><li id="fn1"><p>Although this may not always work out in practice; if
the from-source package manager includes the compiler version and CPU
family as the package spec (“key” for the cache), as Spack does (for
valid performance and reproducibility reasons), the cache will often
miss.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p><a href="https://justine.lol/ape.html" class="external-link">Special hacks</a>
allow multi-OS binaries, but these hacks are uncommon and fragile.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>If the source-code does not use version-control, it
could still use <a href="https://en.wikipedia.org/wiki/Delta_encoding" class="external-link">delta
compression</a> or block-based compression more efficiently than binary
equivalents.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>Package-manager specific patches may be stored
separately, this is still much less storage cost than storing
package-manager specific binaries separately, since the patched source
are already delta-compressed (only store the patch) and usually small<a href="#fnref4" class="footnote-back">↩︎</a></p></li>
<li id="fn5"><p>TODO: Find examples for other pkg mgrs and make into a
details snippet<a href="#fnref5" class="footnote-back">↩︎</a></p></li>
<li id="fn6"><p>TODO: intra-lesson link<a href="#fnref6" class="footnote-back">↩︎</a></p></li>
<li id="fn7"><p>TODO: find their exact commitment<a href="#fnref7" class="footnote-back">↩︎</a></p></li>
<li id="fn8"><p>TODO: link to last lesson<a href="#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>TODO: How does Spack compile the compiler? What about
Nix? What about Guix?<a href="#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>For example, Spack uses <a href="https://github.com/spack/spack/blob/e0c6cca65cd001f1e28beac87318dfb605fab22a/lib/spack/docs/packaging_guide.rst#version-comparison" class="external-link">this
total order</a>, Java uses <a href="https://docs.oracle.com/javase/9/docs/api/java/lang/module/ModuleDescriptor.Version.html" class="external-link">this
one</a>, Python uses <a href="https://peps.python.org/pep-0440/" class="external-link">this
one</a>, Maven uses <a href="https://docs.oracle.com/middleware/1212/core/MAVEN/maven_version.htm" class="external-link">this
one</a>.<a href="#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>Note, this can occur with three packages if the user
wants to install B and C; in that case we could pretend the user wanted
to install a “virtual package” A, that depends on B and C, so the
three-package case is reducible to the four-package case<a href="#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>For a formal proof, see <a href="https://www.sciencedirect.com/science/article/abs/pii/S0164121212000477" class="external-link">Dependency
Solving: a Separate Concern in Component Evolution Management by Abate
et al. in the Journal of Systems and Software 2012</a>; for an informal
proof, see <a href="https://research.swtch.com/version-sat" class="external-link">Version SAT
by Cox on their blog 2016</a><a href="#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>If P ≠ NP, then “fastest known” can be replaced with
“fastest possible”. Computer scientists have been looking for fast
algorithms to NP-complete problems for decades; so far no luck. 88% of
researchers polled (informally) to respond that P ≠ NP (see <a href="https://www.cs.umd.edu/users/gasarch/BLOGPAPERS/pollpaper3.pdf" class="external-link">Guest
Column: The Third P =? NP Poll by Gasarch in SIGACT News Complexity
Theory Column 100 (2019)</a>).<a href="#fnref13" class="footnote-back">↩︎</a></p></li>
<li id="fn14"><p>Mathematically astute readers will note this should
read “<a href="https://en.wikipedia.org/wiki/Time_complexity#Superpolynomial_time" class="external-link">super-polynomial</a>”
not “exponential”, but I did promise to “oversimplify the details” for a
general audience.<a href="#fnref14" class="footnote-back">↩︎</a></p></li>
<li id="fn15"><p>DNF, YUM, and APT technically do dependency solving,
but their package repositories often have just one version of a package
dependency. Usually, only a handful of repositories are enabled. These
package managers <em>can</em> do dependency solves, but often not
efficiently because they rarely encounter large ones.<a href="#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>TODO: Is everything really relocatable?<a href="#fnref16" class="footnote-back">↩︎</a></p></li>
</ol></div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="reproducibility_definition.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="environment_specifications.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="reproducibility_definition.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Reproducibility
        </a>
        <a class="chapter-link float-end" href="environment_specifications.html" rel="next">
          Next: Environment... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/charmoniumQ/reproducibility-carpentry/edit/main/episodes/package_management_theory.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/charmoniumQ/reproducibility-carpentry/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/charmoniumQ/reproducibility-carpentry/" class="external-link">Source</a></p>
				<p><a href="https://github.com/charmoniumQ/reproducibility-carpentry/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:sam@samgrayson.me">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper" class="external-link">sandpaper (0.16.4)</a>, <a href="https://github.com/carpentries/pegboard" class="external-link">pegboard (0.7.5)</a>, and <a href="https://github.com/carpentries/varnish" class="external-link">varnish (1.0.2)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://charmoniumQ.github.io/reproducibility-carpentry/package_management_theory.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "lesson, english, software, reproducibility",
  "name": "Package management theory",
  "creativeWorkStatus": "active",
  "url": "https://charmoniumQ.github.io/reproducibility-carpentry/package_management_theory.html",
  "identifier": "https://charmoniumQ.github.io/reproducibility-carpentry/package_management_theory.html",
  "dateCreated": "2024-04-24",
  "dateModified": "2024-06-18",
  "datePublished": "2024-06-18"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

